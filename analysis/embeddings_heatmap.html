<!DOCTYPE html>
<html>
<head>
<style>
#raw td {
	text-align: center;
}
#freeze {
	background: rgba(128,128,128,0.25);
    position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
}
#loader {
	border: 16px solid #f3f3f3; /* Light grey */
	border-top: 16px solid #3498db; /* Blue */
	border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    margin-top: -50px;
    margin-left: -50px;
	width: 100px;
	height: 100px;
	animation: spin 2s linear infinite;
}
@keyframes spin {
	0% { transform: rotate(0deg); }
	100% { transform: rotate(360deg); }
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="embeddings.js"></script>
<script>
function populateHeatmapInner() {
    if ($('input[name=display]:checked').val() == "words") {
        words = vocab;
    } else {
        words = types;
	}
    if ($('input[name=colors]:checked').val() == "linear") {
        normalizeVal = function(x) { return x };
    } else {
        normalizeVal = Math.sqrt;
	}
	row = '<tr><td style="border-right: 1px solid black; border-bottom: 1px solid black;"></td>';
	words.forEach(function(y) {row += '<td style="border-bottom: 1px solid black;"><div style="width: 50px">'+y+'</div></td>';});
	row += '</tr>'
    $("#raw").append(row);
    i = 0;
    words.forEach(function(x) {
    	row = '<tr id="tr_'+i+'"><td style="border-right: 1px solid black;"><div style="width: 50px">'+x+'</div></td>';
    	j = 0;
		matrix[i].forEach(function(y) {
			row += '<td class="td" id="td_'+i+'_'+j+'">'+parseFloat(Math.round(y * 100) / 100).toFixed(2);+'</td>';
			j++;
		});
		row += '</tr>'
    	$("#raw").append(row);
    	i++;
    });
    // build heatmap
    r = $('#raw tr').length - 1;
    if (r > 0) {
    	c = $('#tr_0 td').length - 1;
    	if (c > 1) {
	    	minVal = maxVal = parseFloat($('#td_0_1').text());
	    	for (i = 0; i < r; i++) {
	    		for (j = 0; j < c; j++) {
	    		    if (i != j) {
                        val = parseFloat($('#td_' + i + '_' + j).text());
                        minVal = Math.min(minVal, val);
                        maxVal = Math.max(maxVal, val);
                    }
	    		}
	    	}
	    	rangeVal = maxVal - minVal;
	    	for (i = 0; i < r; i++) {
	    		for (j = 0; j < c; j++) {
	    		    if (i != j) {
                        val = parseFloat($('#td_' + i + '_' + j).text());
                        ratio = normalizeVal((val - minVal) / rangeVal);
                       $('#td_' + i + '_' + j).css('background', 'rgba('+Math.round(255*ratio)+','+Math.round(255*(1-ratio))+',0,50)');
                    } else {
	    		        $('#td_' + i + '_' + j).css('background', 'rgba(255,255,0,50)');
					}
					$('#td_' + i + '_' + j).attr('title' , words[i]+' -> '+words[j]+' : '+matrix[i][j])
	    		}
	    	}
	    }
    }
	$('#loader').hide();
    $('#freeze').hide();
};
function populateHeatmap() {
	$("#raw").empty();
	$('#freeze').show();
	$('#loader').show();
	setTimeout(populateHeatmapInner, 0);
}
$(document).ready(function() {
	document.title = title;
	populateHeatmap();
	$('input[name=display]').click(function() {
		populateHeatmap();
	});
	$('input[name=colors]').click(function() {
		populateHeatmap();
	});
});
</script>
</head>
<body>
<div id="freeze"><div id="loader"></div></div>
<div>
	<table>
		<tr>
			<td width="100px">
				Display:
			</td>
			<td width="100px">
				<input type="radio" name="display" value="words" checked>words
			</td>
			<td>
				<input type="radio" name="display" value="types" >types
			</td>
		</tr>
		<tr>
			<td width="100px">
				Colors:
			</td>
			<td width="100px">
				<input type="radio" name="colors" value="linear" >linear
			</td>
			<td>
				<input type="radio" name="colors" value="exponential" checked>exponential
			</td>
		</tr>
	</table>
</div>
<br/><br/>
<div>
	<table id="raw" style="border-spacing: 0;">
	</table>
</div>
</body>
</html>
